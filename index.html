<button id="orderBtn" onclick="order()" disabled>тЬЕ ржЕрж░рзНржбрж╛рж░ ржХрж░рзБржи</button>
<button onclick="exportOrders()">ЁЯЧВя╕П ржЕрж░рзНржбрж╛рж░ ржПржХрзНрж╕ржкрзЛрж░рзНржЯ ржХрж░рзБржи (JSON)</button>

<div style="margin-top:30px; font-weight:bold;">ржЕрж░рзНржбрж╛рж░ рж╣рж┐рж╕рзНржЯрзЛрж░рж┐</div>
<div id="orderHistory">ржЖржкржирж╛рж░ ржХрзЛржи ржЕрж░рзНржбрж╛рж░ рж░рзЗржХрж░рзНржб ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред</div>

<!-- Footer -->
<div id="footer" style="margin-top:40px;">
  <p>ЁЯУЮ <strong>ржпрзЛржЧрж╛ржпрзЛржЧ:</strong> <a href="https://t.me/BDTOPUPCOM24" target="_blank">@BDTOPUPCOM24</a></p>
  <p>ЁЯУв <strong>ржЪрзНржпрж╛ржирзЗрж▓:</strong> <a href="https://t.me/BDTOPUPCOM247" target="_blank">BDTOPUPCOM247</a></p>
</div>

<script>
  const uidInput = document.getElementById('uid');
  const trxInput = document.getElementById('trxid');
  const packInput = document.getElementById('selectedPack');
  const orderBtn = document.getElementById('orderBtn');
  const warningMsg = document.getElementById('warningMsg');
  const successMsg = document.getElementById('successMsg');
  const orderHistoryDiv = document.getElementById('orderHistory');
  let selectedBox = null;

  function isValidTransactionID(id) {
    id = id.trim().toUpperCase();
    const bkashPattern = /^[A-Z0-9]{10}$/;     // CGF9OEMIEH
    const nagadPattern = /^[0-9]{4}[A-Z]{4}$/; // 7449JOHV
    return bkashPattern.test(id) || nagadPattern.test(id);
  }

  function openTab(evt, tabName) {
    const tabcontents = document.querySelectorAll('.tabcontent');
    tabcontents.forEach(tc => tc.style.display = 'none');
    const tablinks = document.querySelectorAll('.tab button');
    tablinks.forEach(tl => tl.classList.remove('active'));
    document.getElementById(tabName).style.display = 'block';
    evt.currentTarget.classList.add('active');
    clearSelection();
  }

  function selectPack(elem) {
    if (selectedBox) selectedBox.classList.remove('selected');
    selectedBox = elem;
    elem.classList.add('selected');
    packInput.value = elem.textContent.trim();
    validateInputs();
  }

  function clearSelection() {
    if (selectedBox) selectedBox.classList.remove('selected');
    selectedBox = null;
    packInput.value = '';
    validateInputs();
  }

  function validateInputs() {
    const uid = uidInput.value.trim();
    const trxid = trxInput.value.trim();
    const pack = packInput.value.trim();
    orderBtn.disabled = !(uid && trxid && pack);
  }

  uidInput.addEventListener('input', validateInputs);
  trxInput.addEventListener('input', validateInputs);

  function order() {
    const uid = uidInput.value.trim();
    const trxid = trxInput.value.trim().toUpperCase();
    const pack = packInput.value.trim();

    warningMsg.style.display = 'none';
    successMsg.style.display = 'none';

    if (!isValidTransactionID(trxid)) {
      warningMsg.textContent = 'тЭМ ржЖржкржирж╛рж░ ржЯрзНрж░рж╛ржЮрзНржЬрзЗржХрзНрж╕ржи ржЖржЗржбрж┐ рж╕ржарж┐ржХ ржирзЯ, рж╕ржарж┐ржХ ржЯрзНрж░рж╛ржЮрзНржЬрзЗржХрзНрж╕ржи ржжрж┐рзЯрзЗ ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рзБржи';
      warningMsg.style.display = 'block';
      return;
    }

    if (localStorage.getItem('used_trx_' + trxid)) {
      warningMsg.textContent = 'тЪая╕П ржПржЗ TrxID ржжрж┐рзЯрзЗ ржЖржЧрзЗ ржерзЗржХрзЗржЗ ржЕрж░рзНржбрж╛рж░ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ!';
      warningMsg.style.display = 'block';
      return;
    }

    const orderObj = {
      uid, trxid, pack,
      date: new Date().toLocaleString('bn-BD', {hour12:false}),
      completed: false
    };

    const allOrders = JSON.parse(localStorage.getItem('allOrders') || '[]');
    allOrders.push(orderObj);
    localStorage.setItem('allOrders', JSON.stringify(allOrders));
    localStorage.setItem('used_trx_' + trxid, 'true');

    successMsg.textContent = `тЬЕ ржЕрж░рзНржбрж╛рж░ рж╕ржлрж▓ рж╣рзЯрзЗржЫрзЗ\nUID: ${uid}\nржкрзНржпрж╛ржХрзЗржЬ: ${pack}`;
    successMsg.style.display = 'block';
    uidInput.value = '';
    trxInput.value = '';
    clearSelection();
    displayOrderHistory();

    fetch("https://api.telegram.org/bot7786024985:AAFhfePQ1dtOcf7O85TVHpYTCMPffqZkVYY/sendMessage", {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        chat_id: '6108340963',
        text: `тЬЕ ржирждрзБржи ржЕрж░рзНржбрж╛рж░:\nUID: ${uid}\nTrxID: ${trxid}\nPackage: ${pack}`
      })
    });
  }

  function displayOrderHistory() {
    const allOrders = JSON.parse(localStorage.getItem('allOrders') || '[]');
    if (allOrders.length === 0) {
      orderHistoryDiv.textContent = 'ржЖржкржирж╛рж░ ржХрзЛржи ржЕрж░рзНржбрж╛рж░ рж░рзЗржХрж░рзНржб ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред';
      return;
    }
    orderHistoryDiv.innerHTML = allOrders.map((o, i) => `
      <div style="background:#e3f2fd; margin:8px 0; padding:10px; border-radius:8px;">
        ЁЯУЭ <b>${i+1}.</b> UID: ${o.uid}<br>TrxID: ${o.trxid}<br>Package: ${o.pack}<br>Date: ${o.date}<br>Status: ${o.completed ? 'тЬЕ Completed' : 'тП│ Pending'}
      </div>`).join('');
  }

  function exportOrders() {
    const data = localStorage.getItem('allOrders');
    if (!data) return alert('тЭМ ржПржХрзНрж╕ржкрзЛрж░рзНржЯ ржХрж░рж╛рж░ ржорждрзЛ ржХрзЛржирзЛ ржЕрж░рзНржбрж╛рж░ ржирзЗржЗред');
    const blob = new Blob([data], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'bdtopup_orders.json';
    a.click();
    URL.revokeObjectURL(url);
  }

  displayOrderHistory();
</script>
</body>
</html>
